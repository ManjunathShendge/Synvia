<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>International Phone Input - Fixed</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .phone-input-container {
            position: relative;
            width: 100%;
        }

        .phone-input-wrapper {
            display: flex;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            transition: border-color 0.2s ease;
        }

        .phone-input-wrapper:focus-within {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        .country-selector {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-right: 1px solid #e1e5e9;
            cursor: pointer;
            min-width: 120px;
            user-select: none;
        }

        .country-selector:hover {
            background: #e9ecef;
        }

        .selected-country {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flag {
            width: 20px;
            height: 15px;
            background-size: cover;
            background-position: center;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .dial-code {
            font-weight: 500;
            color: #495057;
        }

        .dropdown-arrow {
            margin-left: auto;
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 6px solid #6c757d;
            transition: transform 0.2s ease;
        }

        .country-selector.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .phone-number-input {
            flex: 1;
            border: none;
            padding: 12px 16px;
            font-size: 16px;
            outline: none;
            background: transparent;
        }

        .phone-number-input::placeholder {
            color: #adb5bd;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e1e5e9;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .country-dropdown.open {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .country-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.15s ease;
            gap: 12px;
        }

        .country-option:hover {
            background-color: #f8f9fa;
        }

        .country-option.highlighted {
            background-color: #007bff;
            color: white;
        }

        .country-name {
            flex: 1;
            font-size: 14px;
        }

        .country-option .dial-code {
            font-size: 14px;
            color: #6c757d;
        }

        .country-option.highlighted .dial-code {
            color: #e3f2fd;
        }

        /* Flag sprites - using CSS to create simple colored rectangles */
        .flag.in { background: linear-gradient(to bottom, #ff9933 33%, white 33%, white 66%, #138808 66%); }
        .flag.us { background: linear-gradient(to bottom, #b22234 50%, white 50%); }
        .flag.gb { background: linear-gradient(45deg, #012169 30%, white 30%, white 70%, #c8102e 70%); }
        .flag.ca { background: linear-gradient(to right, #ff0000 25%, white 25%, white 75%, #ff0000 75%); }
        .flag.au { background: linear-gradient(to bottom, #012169 50%, #ffffff 50%); }
        .flag.de { background: linear-gradient(to bottom, #000 33%, #dd0000 33%, #dd0000 66%, #ffce00 66%); }
        .flag.fr { background: linear-gradient(to right, #0055a4 33%, #ffffff 33%, #ffffff 66%, #ef4135 66%); }
        .flag.jp { background: radial-gradient(circle at center, #bc002d 30%, #ffffff 30%); }
        .flag.cn { background: #de2910; }
        .flag.br { background: linear-gradient(to bottom, #009739 50%, #fedd00 50%); }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-bottom: 1px solid #e1e5e9;
            outline: none;
            font-size: 14px;
            background: #f8f9fa;
        }

        .preferred-countries {
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 8px;
            padding-bottom: 8px;
        }

        .section-title {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f8f9fa;
            margin: 0;
        }

        .label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #343a40;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align: center; color: #343a40; margin-bottom: 30px;">Phone Number Input</h2>
        
        <label class="label" for="phone">Phone Number</label>
        <div class="phone-input-container">
            <div class="phone-input-wrapper">
                <div class="country-selector" id="countrySelector">
                    <div class="selected-country">
                        <div class="flag in" id="selectedFlag"></div>
                        <span class="dial-code" id="selectedDialCode">+91</span>
                    </div>
                    <div class="dropdown-arrow"></div>
                </div>
                <input 
                    type="tel" 
                    class="phone-number-input" 
                    id="phoneInput"
                    placeholder="Enter phone number"
                    maxlength="15"
                >
            </div>
            
            <div class="country-dropdown" id="countryDropdown">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput"
                    placeholder="Search countries..."
                >
                
                <div class="preferred-countries">
                    <div class="section-title">Preferred</div>
                    <div class="country-option" data-code="in" data-dial="+91">
                        <div class="flag in"></div>
                        <span class="country-name">India (भारत)</span>
                        <span class="dial-code">+91</span>
                    </div>
                    <div class="country-option" data-code="us" data-dial="+1">
                        <div class="flag us"></div>
                        <span class="country-name">United States</span>
                        <span class="dial-code">+1</span>
                    </div>
                    <div class="country-option" data-code="gb" data-dial="+44">
                        <div class="flag gb"></div>
                        <span class="country-name">United Kingdom</span>
                        <span class="dial-code">+44</span>
                    </div>
                    <div class="country-option" data-code="ca" data-dial="+1">
                        <div class="flag ca"></div>
                        <span class="country-name">Canada</span>
                        <span class="dial-code">+1</span>
                    </div>
                    <div class="country-option" data-code="au" data-dial="+61">
                        <div class="flag au"></div>
                        <span class="country-name">Australia</span>
                        <span class="dial-code">+61</span>
                    </div>
                </div>
                
                <div class="section-title">All Countries</div>
                <div class="country-option" data-code="de" data-dial="+49">
                    <div class="flag de"></div>
                    <span class="country-name">Germany (Deutschland)</span>
                    <span class="dial-code">+49</span>
                </div>
                <div class="country-option" data-code="fr" data-dial="+33">
                    <div class="flag fr"></div>
                    <span class="country-name">France</span>
                    <span class="dial-code">+33</span>
                </div>
                <div class="country-option" data-code="jp" data-dial="+81">
                    <div class="flag jp"></div>
                    <span class="country-name">Japan (日本)</span>
                    <span class="dial-code">+81</span>
                </div>
                <div class="country-option" data-code="cn" data-dial="+86">
                    <div class="flag cn"></div>
                    <span class="country-name">China (中国)</span>
                    <span class="dial-code">+86</span>
                </div>
                <div class="country-option" data-code="br" data-dial="+55">
                    <div class="flag br"></div>
                    <span class="country-name">Brazil (Brasil)</span>
                    <span class="dial-code">+55</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class PhoneInput {
            constructor() {
                this.countrySelector = document.getElementById('countrySelector');
                this.countryDropdown = document.getElementById('countryDropdown');
                this.searchInput = document.getElementById('searchInput');
                this.selectedFlag = document.getElementById('selectedFlag');
                this.selectedDialCode = document.getElementById('selectedDialCode');
                this.phoneInput = document.getElementById('phoneInput');
                this.isOpen = false;
                this.highlightedIndex = -1;
                
                this.init();
            }

            init() {
                // Toggle dropdown
                this.countrySelector.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleDropdown();
                });

                // Country selection
                this.countryDropdown.addEventListener('click', (e) => {
                    const option = e.target.closest('.country-option');
                    if (option) {
                        this.selectCountry(option);
                    }
                });

                // Search functionality
                this.searchInput.addEventListener('input', (e) => {
                    this.filterCountries(e.target.value);
                });

                // Keyboard navigation
                this.searchInput.addEventListener('keydown', (e) => {
                    this.handleKeydown(e);
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.countryDropdown.contains(e.target) && !this.countrySelector.contains(e.target)) {
                        this.closeDropdown();
                    }
                });

                // Prevent dropdown from closing when clicking inside
                this.countryDropdown.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }

            toggleDropdown() {
                if (this.isOpen) {
                    this.closeDropdown();
                } else {
                    this.openDropdown();
                }
            }

            openDropdown() {
                this.isOpen = true;
                this.countrySelector.classList.add('open');
                this.countryDropdown.classList.add('open');
                this.searchInput.focus();
                this.searchInput.value = '';
                this.filterCountries('');
            }

            closeDropdown() {
                this.isOpen = false;
                this.countrySelector.classList.remove('open');
                this.countryDropdown.classList.remove('open');
                this.highlightedIndex = -1;
                this.clearHighlight();
            }

            selectCountry(option) {
                const code = option.dataset.code;
                const dial = option.dataset.dial;
                const name = option.querySelector('.country-name').textContent;

                // Update selected display
                this.selectedFlag.className = `flag ${code}`;
                this.selectedDialCode.textContent = dial;

                // Focus phone input
                this.phoneInput.focus();
                
                this.closeDropdown();
            }

            filterCountries(query) {
                const options = this.countryDropdown.querySelectorAll('.country-option');
                const lowerQuery = query.toLowerCase();
                
                options.forEach(option => {
                    const countryName = option.querySelector('.country-name').textContent.toLowerCase();
                    const dialCode = option.querySelector('.dial-code').textContent;
                    
                    if (countryName.includes(lowerQuery) || dialCode.includes(query)) {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });

                this.highlightedIndex = -1;
                this.clearHighlight();
            }

            handleKeydown(e) {
                const visibleOptions = Array.from(this.countryDropdown.querySelectorAll('.country-option'))
                    .filter(option => option.style.display !== 'none');

                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.highlightedIndex = Math.min(this.highlightedIndex + 1, visibleOptions.length - 1);
                        this.updateHighlight(visibleOptions);
                        break;
                        
                    case 'ArrowUp':
                        e.preventDefault();
                        this.highlightedIndex = Math.max(this.highlightedIndex - 1, 0);
                        this.updateHighlight(visibleOptions);
                        break;
                        
                    case 'Enter':
                        e.preventDefault();
                        if (this.highlightedIndex >= 0 && visibleOptions[this.highlightedIndex]) {
                            this.selectCountry(visibleOptions[this.highlightedIndex]);
                        }
                        break;
                        
                    case 'Escape':
                        this.closeDropdown();
                        this.phoneInput.focus();
                        break;
                }
            }

            updateHighlight(visibleOptions) {
                this.clearHighlight();
                if (this.highlightedIndex >= 0 && visibleOptions[this.highlightedIndex]) {
                    visibleOptions[this.highlightedIndex].classList.add('highlighted');
                    visibleOptions[this.highlightedIndex].scrollIntoView({ block: 'nearest' });
                }
            }

            clearHighlight() {
                this.countryDropdown.querySelectorAll('.country-option').forEach(option => {
                    option.classList.remove('highlighted');
                });
            }
        }

        // Initialize the phone input
        new PhoneInput();
    </script>
</body>
</html>